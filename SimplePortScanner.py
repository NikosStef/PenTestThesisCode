#!/usr/bin/python
import sys
import socket
import threading
from datetime import datetime

'''Threaded Port Scanner

Parameters
----------
IP : str
    IP to perform a port scan on

Returns:
---------
    Prints open ports
'''

def setup():
    # Define Target
    if len(sys.argv) == 2:
        target = socket.gethostbyname(sys.argv[1])
    else:
        print("Invalid amount of arguments.\n")
        print("Syntax: python SimplePortScannet.py <IP>")
        sys.exit()

    print("-" * 25)
    print("\nScanning target " + target)
    print("\nTime started: " + str(datetime.now()))
    print("-" * 25)

    # Create a thread for every port scanned and execute function "handle_ports"
    # on each one of them with the specified arguments
    for port in range(50,85):
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        socket.setdefaulttimeout(1)
        threading.Thread(target=handle_ports,
                           args = (s,target,port)).start()

def handle_ports(socket, target, port):
    try :
        # Try to connect to the specidied IP and port
        result = socket.connect_ex((target,port)) # Error indicator
        if result == 0:
            print("**Port {} is open***\n".format(port))
        socket.close()

    except KeyboardInterrupt:
        print("\nExiting...")
        sys.exit()

    print("\nTime finished: " + str(datetime.now()))


if __name__ == "__main__":
    setup()
